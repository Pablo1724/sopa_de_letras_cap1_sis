<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sopa de Letras Pro - Sistemas Digitales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono:wght@700&display=swap');
        
        :root {
            --bg-dark: #020617;
            --primary: #3b82f6;
            --accent: #10b981;
            --cell-bg: #1e293b;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-dark);
            color: #f8fafc;
            margin: 0;
            overflow-x: hidden;
        }

        /* Maximización del Tablero */
        .game-wrapper {
            display: flex;
            flex-direction: row;
            gap: 20px;
            padding: 20px;
            height: calc(100vh - 120px);
            align-items: stretch;
        }

        .grid-container {
            display: grid;
            gap: 4px;
            background: #0f172a;
            padding: 12px;
            border-radius: 16px;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
            flex-grow: 2;
            user-select: none;
            touch-action: none;
        }

        .letter-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--cell-bg);
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: clamp(0.7rem, 1.5vw, 1.3rem);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.1s;
            color: #94a3b8;
            aspect-ratio: 1 / 1;
        }

        .letter-cell:hover {
            background: #334155;
            color: white;
            transform: scale(1.05);
            z-index: 10;
        }

        .letter-cell.selecting {
            background: var(--primary);
            color: white;
        }

        .letter-cell.found {
            background: var(--accent);
            color: white;
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* Panel Lateral de Palabras */
        .sidebar {
            width: 300px;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid #1e293b;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .word-list {
            overflow-y: auto;
            flex-grow: 1;
        }

        .word-item {
            padding: 8px 15px;
            margin-bottom: 6px;
            border-radius: 10px;
            background: #0f172a;
            border: 1px solid #1e293b;
            font-size: 0.85rem;
            font-weight: 600;
            transition: 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .word-item.completed {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--accent);
            color: var(--accent);
            text-decoration: line-through;
            opacity: 0.7;
        }

        .circuit-deco {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 10L90 10M90 10L90 90M90 90L10 90M10 90L10 10' fill='none' stroke='white' stroke-width='0.5'/%3E%3Ccircle cx='10' cy='10' r='2' fill='white'/%3E%3C/svg%3E");
        }

        @media (max-width: 1024px) {
            .game-wrapper { flex-direction: column; height: auto; }
            .sidebar { width: 100%; }
            .grid-container { height: 70vh; }
        }
    </style>
</head>
<body>

    <div class="circuit-deco"></div>

    <!-- Header Minimalista -->
    <header class="py-4 px-8 flex justify-between items-center bg-slate-950 border-b border-slate-800">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white shadow-lg shadow-blue-900/50">
                <i class="fas fa-microchip text-xl"></i>
            </div>
            <div>
                <h1 class="text-xl font-black tracking-tighter uppercase leading-none">Desafío Lógico</h1>
                <span class="text-[10px] font-bold text-blue-400 tracking-[0.2em] uppercase">Sistemas Digitales I</span>
            </div>
        </div>
        
        <div class="flex items-center gap-8">
            <div class="text-center">
                <span class="block text-[9px] font-bold text-slate-500 uppercase tracking-widest">Cronómetro</span>
                <span id="timer" class="text-xl font-black text-white mono">00:00</span>
            </div>
            <button onclick="window.location.reload()" class="bg-slate-800 hover:bg-blue-600 text-white p-3 rounded-xl transition-all shadow-lg">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </header>

    <main class="game-wrapper">
        
        <!-- Tablero Principal (Gigante) -->
        <div id="gridBoard" class="grid-container">
            <!-- Inyectado por JS -->
        </div>

        <!-- Panel Lateral -->
        <aside class="sidebar">
            <div class="mb-6">
                <h2 class="text-lg font-extrabold flex items-center gap-2">
                    <i class="fas fa-list-ul text-blue-500"></i> Diccionario
                </h2>
                <p class="text-[10px] text-slate-400 font-medium">Encuentra los términos del Capítulo 1</p>
            </div>

            <div id="wordList" class="word-list custom-scrollbar">
                <!-- Inyectado por JS -->
            </div>

            <div class="mt-6 pt-4 border-t border-slate-800">
                <div class="flex justify-between items-end mb-4">
                    <span class="text-[10px] font-bold text-slate-500 uppercase">Progreso</span>
                    <span id="progressText" class="text-2xl font-black text-blue-500">0/12</span>
                </div>
                <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                    <div id="progressBar" class="bg-blue-600 h-full w-0 transition-all duration-500"></div>
                </div>
            </div>
        </aside>
    </main>

    <!-- Modal de Victoria -->
    <div id="victoryModal" class="fixed inset-0 bg-black/90 z-[100] hidden flex items-center justify-center p-6">
        <div class="bg-slate-900 border-2 border-emerald-500 p-10 rounded-[3rem] text-center max-w-md shadow-[0_0_50px_rgba(16,185,129,0.3)]">
            <div class="w-20 h-20 bg-emerald-500 text-white rounded-full flex items-center justify-center text-4xl mx-auto mb-6">
                <i class="fas fa-trophy"></i>
            </div>
            <h2 class="text-3xl font-black mb-2">¡SISTEMA OPTIMIZADO!</h2>
            <p class="text-slate-400 mb-8 leading-relaxed">Has localizado todos los conceptos clave de los sistemas numéricos en tiempo récord.</p>
            <button onclick="window.location.reload()" class="w-full py-4 bg-emerald-600 hover:bg-emerald-500 text-white rounded-2xl font-bold transition-all uppercase tracking-widest text-xs">
                Reiniciar Servidor
            </button>
        </div>
    </div>

    <script>
        const WORDS = [
            "ARITMETICA", "COMPLEMENTO", "HEXADECIMAL", "BINARIO",
            "OCTAL", "DECIMAL", "RADIX", "DIGITO",
            "SUMADOR", "BCD", "SIGNO", "ACARREO"
        ];
        const GRID_SIZE = 20; // Tamaño masivo
        
        let grid = [];
        let foundWords = [];
        let isSelecting = false;
        let startCell = null;
        let currentSelection = [];
        let seconds = 0;

        function init() {
            // Inicializar grid vacío
            grid = Array(GRID_SIZE).fill(null).map(() => Array(GRID_SIZE).fill(' '));
            
            // 1. Ordenar palabras por longitud descendente
            const sortedWords = [...WORDS].sort((a, b) => b.length - a.length);
            
            // 2. Colocar palabras
            sortedWords.forEach(word => placeWord(word));
            
            // 3. Rellenar con letras aleatorias
            for(let r=0; r<GRID_SIZE; r++) {
                for(let c=0; c<GRID_SIZE; c++) {
                    if(grid[r][c] === ' ') {
                        grid[r][c] = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                    }
                }
            }

            render();
            startTimer();
        }

        function placeWord(word) {
            const directions = [
                [0, 1], [1, 0], [1, 1], [-1, 1], [0, -1], [-1, 0], [-1, -1], [1, -1]
            ];
            let placed = false;
            let attempts = 0;

            while (!placed && attempts < 1000) {
                const dir = directions[Math.floor(Math.random() * directions.length)];
                const r = Math.floor(Math.random() * GRID_SIZE);
                const c = Math.floor(Math.random() * GRID_SIZE);

                if (canPlace(word, r, c, dir)) {
                    for (let i = 0; i < word.length; i++) {
                        grid[r + i * dir[0]][c + i * dir[1]] = word[i];
                    }
                    placed = true;
                }
                attempts++;
            }
        }

        function canPlace(word, r, c, dir) {
            for (let i = 0; i < word.length; i++) {
                const nr = r + i * dir[0];
                const nc = c + i * dir[1];
                if (nr < 0 || nr >= GRID_SIZE || nc < 0 || nc >= GRID_SIZE) return false;
                if (grid[nr][nc] !== ' ' && grid[nr][nc] !== word[i]) return false;
            }
            return true;
        }

        function render() {
            const board = document.getElementById('gridBoard');
            board.style.gridTemplateColumns = `repeat(${GRID_SIZE}, 1fr)`;
            board.innerHTML = '';

            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'letter-cell';
                    cell.innerText = grid[r][c];
                    cell.dataset.r = r;
                    cell.dataset.c = c;
                    
                    cell.addEventListener('mousedown', startSelect);
                    cell.addEventListener('mouseenter', updateSelect);
                    cell.addEventListener('mouseup', endSelect);
                    
                    // Touch events
                    cell.addEventListener('touchstart', (e) => { e.preventDefault(); startSelect(e); });
                    cell.addEventListener('touchmove', (e) => {
                        e.preventDefault();
                        const touch = e.touches[0];
                        const el = document.elementFromPoint(touch.clientX, touch.clientY);
                        if (el && el.classList.contains('letter-cell')) updateSelect({ target: el });
                    });
                    cell.addEventListener('touchend', endSelect);

                    board.appendChild(cell);
                }
            }

            const list = document.getElementById('wordList');
            list.innerHTML = '';
            WORDS.sort().forEach(word => {
                const item = document.createElement('div');
                item.className = 'word-item';
                item.id = `list-${word}`;
                item.innerHTML = `<span>${word}</span> <i class="fas fa-circle-notch opacity-20"></i>`;
                list.appendChild(item);
            });
        }

        function startSelect(e) {
            isSelecting = true;
            startCell = e.target;
            currentSelection = [startCell];
            startCell.classList.add('selecting');
        }

        function updateSelect(e) {
            if (!isSelecting) return;
            const target = e.target;
            if (target === startCell || !target.classList.contains('letter-cell')) return;

            const r1 = parseInt(startCell.dataset.r);
            const c1 = parseInt(startCell.dataset.c);
            const r2 = parseInt(target.dataset.r);
            const c2 = parseInt(target.dataset.c);

            // Calcular dirección
            const dr = r2 - r1;
            const dc = c2 - c1;
            const dist = Math.max(Math.abs(dr), Math.abs(dc));

            // Solo permitir líneas rectas
            if (dr === 0 || dc === 0 || Math.abs(dr) === Math.abs(dc)) {
                document.querySelectorAll('.letter-cell.selecting').forEach(el => el.classList.remove('selecting'));
                currentSelection = [];
                
                const stepR = dr === 0 ? 0 : dr / dist;
                const stepC = dc === 0 ? 0 : dc / dist;

                for (let i = 0; i <= dist; i++) {
                    const cell = document.querySelector(`[data-r="${r1 + i * stepR}"][data-c="${c1 + i * stepC}"]`);
                    if (cell) {
                        cell.classList.add('selecting');
                        currentSelection.push(cell);
                    }
                }
            }
        }

        function endSelect() {
            if (!isSelecting) return;
            isSelecting = false;
            
            const word = currentSelection.map(c => c.innerText).join('');
            const reversed = word.split('').reverse().join('');

            if (WORDS.includes(word) && !foundWords.includes(word)) {
                markFound(word);
            } else if (WORDS.includes(reversed) && !foundWords.includes(reversed)) {
                markFound(reversed);
            }

            document.querySelectorAll('.letter-cell.selecting').forEach(el => el.classList.remove('selecting'));
        }

        function markFound(word) {
            foundWords.push(word);
            currentSelection.forEach(c => c.classList.add('found'));
            
            const listItem = document.getElementById(`list-${word}`);
            listItem.classList.add('completed');
            listItem.querySelector('i').className = "fas fa-check-circle";

            const progress = (foundWords.length / WORDS.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').innerText = `${foundWords.length}/${WORDS.length}`;

            if (foundWords.length === WORDS.length) {
                document.getElementById('victoryModal').classList.remove('hidden');
            }
        }

        function startTimer() {
            setInterval(() => {
                seconds++;
                const m = Math.floor(seconds / 60).toString().padStart(2, '0');
                const s = (seconds % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${m}:${s}`;
            }, 1000);
        }

        window.onload = init;
    </script>
</body>
</html>
